## СИСТЕМА АВТОМАТИЧЕСКИ ОПРЕДЕЛЯЕТ СИСТЕМНУЮ ТЕМУ

### Что было исправлено

При запуске приложение теперь:

1. **По умолчанию использует системную тему** ("system")
   - Если у вас на ПК тёмная тема → приложение откроется с тёмной темой
   - Если у вас на ПК светлая тема → приложение откроется со светлой темой

2. **Правильно определяет реальную системную тему**
   - Проверяет цвет текста в палитре приложения
   - Если текст светлый (RGB > 128) → применяет тёмную тему
   - Если текст тёмный (RGB < 128) → применяет светлую тему

3. **Применяет тему ПОСЛЕ инициализации приложения**
   - Раньше тема применялась до полной инициализации UI
   - Теперь используется QTimer.singleShot(100ms) для отложенного применения
   - Это гарантирует, что приложение полностью готово к смене темы

### Изменённые файлы

#### `pysheets/src/ui/main_window.py`
- Строка 140-142: Применение темы перенесено в отложенное выполнение через QTimer
  ```python
  QTimer.singleShot(100, lambda: self.apply_theme(self.current_theme, self.app_theme_color))
  ```

#### `pysheets/src/ui/themes.py`
- Строки 23-47: Улучшена логика определения системной темы
  - Теперь проверяет цвет текста в палитре приложения
  - Корректно определяет тёмную/светлую тему

### Как это работает

1. **При запуске приложения:**
   ```
   app создаётся → window создаётся → window.show() → window.apply_theme() (через 100ms)
   ```

2. **В apply_theme для системной темы:**
   ```
   Проверяем QPalette.Text
   → Если светлый текст (>128) → тёмная тема
   → Если тёмный текст (<128) → светлая тема
   ```

3. **Результат:**
   - Приложение автоматически открывается в той же теме, что и ваш рабочий стол
   - Можно вручную переключить в настройках на светлую/тёмную/системную

### Тестирование

Запустите тест для проверки:
```bash
python test_system_theme_startup.py
```

Этот тест проверит:
- Определение системной темы
- Применение правильной палитры
- Работу ИИ чата с системной темой
